# Customer Segmentation Analysis

**Description:**  
This project uses RFM (Recency, Frequency, Monetary) analysis to segment customers based on their purchase behavior. The segmentation helps businesses identify key customer groups such as Best Customers, At-Risk Customers, and more. This analysis aids in customer targeting for marketing and retention strategies.

## Features
- Create and populate an RFM table to store customer scores and segments.
- Segment customers based on RFM scores.
- Perform detailed customer behavior and purchasing pattern analysis.
- Identify key customer groups like high spenders, frequent buyers, and at-risk customers.

## Initial Queries

### 1. Create the RFM Table
```sql
CREATE TABLE RFM_Table (
    CustomerID INT PRIMARY KEY,
    Frequency INT,
    Monetary DOUBLE,
    Recency INT,
    Recency_Score INT,
    Frequency_Score INT,
    Monetary_Score INT,
    Customer_Segment VARCHAR(50)
);

# Customer Segmentation Analysis

**Description:**  
This project uses RFM (Recency, Frequency, Monetary) analysis to segment customers based on their purchase behavior. The segmentation helps businesses identify key customer groups such as Best Customers, At-Risk Customers, and more. This analysis aids in customer targeting for marketing and retention strategies.

## Features
- Create and populate an RFM table to store customer scores and segments.
- Segment customers based on RFM scores.
- Perform detailed customer behavior and purchasing pattern analysis.
- Identify key customer groups like high spenders, frequent buyers, and at-risk customers.

## Initial Queries

### 1. Create the RFM Table
```sql
CREATE TABLE RFM_Table (
    CustomerID INT PRIMARY KEY,
    Frequency INT,
    Monetary DOUBLE,
    Recency INT,
    Recency_Score INT,
    Frequency_Score INT,
    Monetary_Score INT,
    Customer_Segment VARCHAR(50)
);
2. Calculate RFM Scores and Create Temporary Table
sql
Copy code
CREATE TEMPORARY TABLE Temp_RFM_Scores AS (
    WITH RFM_CTE AS (
        SELECT
            CustomerID,
            DATEDIFF('2023-06-10', MAX(PurchaseDate)) AS Recency,
            COUNT(OrderID) AS Frequency,
            SUM(TransactionAmount) AS Monetary
        FROM rfm_data
        GROUP BY CustomerID
    ),
    RFM_Scores AS (
        SELECT
            CustomerID,
            Recency,
            Frequency,
            Monetary,
            NTILE(5) OVER (ORDER BY Recency) AS Recency_Score,
            NTILE(5) OVER (ORDER BY Frequency DESC) AS Frequency_Score,
            NTILE(5) OVER (ORDER BY Monetary DESC) AS Monetary_Score
        FROM RFM_CTE
    )
    SELECT
        CustomerID,
        Frequency,
        Monetary,
        Recency,
        Recency_Score,
        Frequency_Score,
        Monetary_Score,
        CASE
            WHEN Recency_Score = 5 AND Frequency_Score = 5 AND Monetary_Score = 5 THEN 'Best Customers'
            WHEN Recency_Score <= 2 AND Frequency_Score <= 2 AND Monetary_Score <= 2 THEN 'At-Risk Customers'
            ELSE 'Other'
        END AS Customer_Segment
    FROM RFM_Scores
);
3. Insert Data into RFM Table
sql
Copy code
INSERT INTO RFM_Table (CustomerID, Frequency, Monetary, Recency, Recency_Score, Frequency_Score, Monetary_Score, Customer_Segment)
SELECT
    CustomerID,
    Frequency,
    Monetary,
    Recency,
    Recency_Score,
    Frequency_Score,
    Monetary_Score,
    Customer_Segment
FROM Temp_RFM_Scores;
4. Drop the Temporary Table
sql
Copy code
DROP TEMPORARY TABLE IF EXISTS Temp_RFM_Scores;
Analysis Questions & SQL Queries
1. Who are our most frequent buyers?
sql
Copy code
SELECT CustomerID, Frequency
FROM RFM_Table
ORDER BY Frequency DESC
LIMIT 10;
2. Who are our highest-spending customers, and how can we target them?
sql
Copy code
SELECT CustomerID, Monetary
FROM RFM_Table
ORDER BY Monetary DESC
LIMIT 10;
3. Which customers have not made a purchase in a long time and are at risk of churning?
sql
Copy code
SELECT CustomerID, Recency, Frequency
FROM RFM_Table
WHERE Frequency < 3 AND Recency > 30
ORDER BY Recency DESC;
4. What percentage of our revenue comes from our top customers?
sql
Copy code
WITH Total_Revenue AS (
    SELECT SUM(TransactionAmount) AS total_revenue
    FROM rfm_data
),
Top_Customers AS (
    SELECT SUM(TransactionAmount) AS top_customers_revenue
    FROM (
        SELECT CustomerID, SUM(TransactionAmount) AS TransactionAmount
        FROM rfm_data
        GROUP BY CustomerID
        ORDER BY TransactionAmount DESC
        LIMIT 10
    ) AS Top10
)
SELECT (Top_Customers.top_customers_revenue / Total_Revenue.total_revenue) * 100 AS percentage_of_revenue_from_top_customers
FROM Total_Revenue, Top_Customers;
5. How much revenue is generated by each customer segment?
sql
Copy code
SELECT Customer_Segment, SUM(Monetary) AS total_revenue_per_segment
FROM RFM_Table
GROUP BY Customer_Segment;
6. What is the difference in spending habits between new and loyal customers?
sql
Copy code
SELECT CASE
         WHEN Frequency = 1 THEN 'New Customers'
         ELSE 'Loyal Customers'
       END AS Customer_Type,
       ROUND(AVG(Monetary),2) AS Average_Spending
FROM RFM_Table
GROUP BY Customer_Type;
7. What is the average transaction value per customer segment?
sql
Copy code
SELECT Customer_Segment, AVG(Monetary) AS Average_Transaction_Value
FROM RFM_Table
GROUP BY Customer_Segment;
8. How does the distribution of purchases vary across time periods?
sql
Copy code
SELECT DATE_FORMAT(PurchaseDate, '%Y-%m') AS Purchase_Month, COUNT(OrderID) AS Number_of_Purchases, ROUND(SUM(TransactionAmount),2) AS Total_Sales
FROM rfm_data
GROUP BY Purchase_Month
ORDER BY Purchase_Month;
9. What percentage of customers have made only one purchase?
sql
Copy code
SELECT (COUNT(CustomerID) * 100.0 / (SELECT COUNT(DISTINCT CustomerID) FROM rfm_data)) AS Percentage_One_Time_Buyers
FROM RFM_Table
WHERE Frequency = 1;
10. What are the purchasing patterns of repeat buyers compared to one-time buyers?
sql
Copy code
SELECT CASE
         WHEN Frequency = 1 THEN 'One-Time Buyers'
         ELSE 'Repeat Buyers'
       END AS Buyer_Type,
       COUNT(CustomerID) AS Number_of_Customers,
       AVG(Monetary) AS Average_Spending
FROM RFM_Table
GROUP BY Buyer_Type;
11. How do recency and frequency affect a customer’s likelihood of making a high-value purchase?
sql
Copy code
SELECT CASE
         WHEN Frequency >= 3 AND Recency <= 30 THEN 'High-Value Likely'
         ELSE 'Not High-Value Likely'
       END AS Likelihood,
       COUNT(CustomerID) AS Number_of_Customers,
       ROUND(AVG(Monetary),2) AS Average_Spending
FROM RFM_Table
GROUP BY Likelihood;
12. Which locations have the highest concentration of best customers?
sql
Copy code
SELECT rd.Location, COUNT(rt.CustomerID) AS Number_of_Best_Customers
FROM RFM_Table rt
JOIN rfm_data rd ON rt.CustomerID = rd.CustomerID
WHERE rt.Customer_Segment = 'Best Customers'
GROUP BY rd.Location
ORDER BY Number_of_Best_Customers DESC;
13. Which cities are seeing the most churned or at-risk customers?
sql
Copy code
SELECT rd.Location, COUNT(rt.CustomerID) AS Number_of_At_Risk_Customers
FROM RFM_Table rt
JOIN rfm_data rd ON rt.CustomerID = rd.CustomerID
WHERE rt.Customer_Segment = 'At-Risk Customers'
GROUP BY rd.Location
ORDER BY Number_of_At_Risk_Customers DESC;
How to Use
Clone the repository:
bash
Copy code
git clone https://github.com/your-username/Customer-Segmentation-Analysis.git
Load the rfm_data table into your database.
Run the provided SQL script to create the RFM table, calculate RFM scores, and perform customer segmentation analysis.
yaml
Copy code

---

Feel free to replace `your-username` with your actual GitHub username in the "How to Use" section. You can save this as a `README.md` file in your repository. If you need any further modifications, just let me know!





You said:
i want to show all the queries and questions in the readme file 
ChatGPT said:
ChatGPT
Here's an updated README file that includes all the analysis questions along with their corresponding SQL queries:

markdown
Copy code
# Customer Segmentation Analysis

**Description:**  
This project uses RFM (Recency, Frequency, Monetary) analysis to segment customers based on their purchase behavior. The segmentation helps businesses identify key customer groups such as Best Customers, At-Risk Customers, and more. This analysis aids in customer targeting for marketing and retention strategies.

## Features
- Create and populate an RFM table to store customer scores and segments.
- Segment customers based on RFM scores.
- Perform detailed customer behavior and purchasing pattern analysis.
- Identify key customer groups like high spenders, frequent buyers, and at-risk customers.

## Initial Queries

### 1. Create the RFM Table
```sql
CREATE TABLE RFM_Table (
    CustomerID INT PRIMARY KEY,
    Frequency INT,
    Monetary DOUBLE,
    Recency INT,
    Recency_Score INT,
    Frequency_Score INT,
    Monetary_Score INT,
    Customer_Segment VARCHAR(50)
);
2. Calculate RFM Scores and Create Temporary Table
sql
Copy code
CREATE TEMPORARY TABLE Temp_RFM_Scores AS (
    WITH RFM_CTE AS (
        SELECT
            CustomerID,
            DATEDIFF('2023-06-10', MAX(PurchaseDate)) AS Recency,
            COUNT(OrderID) AS Frequency,
            SUM(TransactionAmount) AS Monetary
        FROM rfm_data
        GROUP BY CustomerID
    ),
    RFM_Scores AS (
        SELECT
            CustomerID,
            Recency,
            Frequency,
            Monetary,
            NTILE(5) OVER (ORDER BY Recency) AS Recency_Score,
            NTILE(5) OVER (ORDER BY Frequency DESC) AS Frequency_Score,
            NTILE(5) OVER (ORDER BY Monetary DESC) AS Monetary_Score
        FROM RFM_CTE
    )
    SELECT
        CustomerID,
        Frequency,
        Monetary,
        Recency,
        Recency_Score,
        Frequency_Score,
        Monetary_Score,
        CASE
            WHEN Recency_Score = 5 AND Frequency_Score = 5 AND Monetary_Score = 5 THEN 'Best Customers'
            WHEN Recency_Score <= 2 AND Frequency_Score <= 2 AND Monetary_Score <= 2 THEN 'At-Risk Customers'
            ELSE 'Other'
        END AS Customer_Segment
    FROM RFM_Scores
);
3. Insert Data into RFM Table
sql
Copy code
INSERT INTO RFM_Table (CustomerID, Frequency, Monetary, Recency, Recency_Score, Frequency_Score, Monetary_Score, Customer_Segment)
SELECT
    CustomerID,
    Frequency,
    Monetary,
    Recency,
    Recency_Score,
    Frequency_Score,
    Monetary_Score,
    Customer_Segment
FROM Temp_RFM_Scores;
4. Drop the Temporary Table
sql
Copy code
DROP TEMPORARY TABLE IF EXISTS Temp_RFM_Scores;
Analysis Questions & SQL Queries
1. Who are our most frequent buyers?
sql
Copy code
SELECT CustomerID, Frequency
FROM RFM_Table
ORDER BY Frequency DESC
LIMIT 10;
2. Who are our highest-spending customers, and how can we target them?
sql
Copy code
SELECT CustomerID, Monetary
FROM RFM_Table
ORDER BY Monetary DESC
LIMIT 10;
3. Which customers have not made a purchase in a long time and are at risk of churning?
sql
Copy code
SELECT CustomerID, Recency, Frequency
FROM RFM_Table
WHERE Frequency < 3 AND Recency > 30
ORDER BY Recency DESC;
4. What percentage of our revenue comes from our top customers?
sql
Copy code
WITH Total_Revenue AS (
    SELECT SUM(TransactionAmount) AS total_revenue
    FROM rfm_data
),
Top_Customers AS (
    SELECT SUM(TransactionAmount) AS top_customers_revenue
    FROM (
        SELECT CustomerID, SUM(TransactionAmount) AS TransactionAmount
        FROM rfm_data
        GROUP BY CustomerID
        ORDER BY TransactionAmount DESC
        LIMIT 10
    ) AS Top10
)
SELECT (Top_Customers.top_customers_revenue / Total_Revenue.total_revenue) * 100 AS percentage_of_revenue_from_top_customers
FROM Total_Revenue, Top_Customers;
5. How much revenue is generated by each customer segment?
sql
Copy code
SELECT Customer_Segment, SUM(Monetary) AS total_revenue_per_segment
FROM RFM_Table
GROUP BY Customer_Segment;
6. What is the difference in spending habits between new and loyal customers?
sql
Copy code
SELECT CASE
         WHEN Frequency = 1 THEN 'New Customers'
         ELSE 'Loyal Customers'
       END AS Customer_Type,
       ROUND(AVG(Monetary),2) AS Average_Spending
FROM RFM_Table
GROUP BY Customer_Type;
7. What is the average transaction value per customer segment?
sql
Copy code
SELECT Customer_Segment, AVG(Monetary) AS Average_Transaction_Value
FROM RFM_Table
GROUP BY Customer_Segment;
8. How does the distribution of purchases vary across time periods?
sql
Copy code
SELECT DATE_FORMAT(PurchaseDate, '%Y-%m') AS Purchase_Month, COUNT(OrderID) AS Number_of_Purchases, ROUND(SUM(TransactionAmount),2) AS Total_Sales
FROM rfm_data
GROUP BY Purchase_Month
ORDER BY Purchase_Month;
9. What percentage of customers have made only one purchase?
sql
Copy code
SELECT (COUNT(CustomerID) * 100.0 / (SELECT COUNT(DISTINCT CustomerID) FROM rfm_data)) AS Percentage_One_Time_Buyers
FROM RFM_Table
WHERE Frequency = 1;
10. What are the purchasing patterns of repeat buyers compared to one-time buyers?
sql
Copy code
SELECT CASE
         WHEN Frequency = 1 THEN 'One-Time Buyers'
         ELSE 'Repeat Buyers'
       END AS Buyer_Type,
       COUNT(CustomerID) AS Number_of_Customers,
       AVG(Monetary) AS Average_Spending
FROM RFM_Table
GROUP BY Buyer_Type;
11. How do recency and frequency affect a customer’s likelihood of making a high-value purchase?
sql
Copy code
SELECT CASE
         WHEN Frequency >= 3 AND Recency <= 30 THEN 'High-Value Likely'
         ELSE 'Not High-Value Likely'
       END AS Likelihood,
       COUNT(CustomerID) AS Number_of_Customers,
       ROUND(AVG(Monetary),2) AS Average_Spending
FROM RFM_Table
GROUP BY Likelihood;
12. Which locations have the highest concentration of best customers?
sql
Copy code
SELECT rd.Location, COUNT(rt.CustomerID) AS Number_of_Best_Customers
FROM RFM_Table rt
JOIN rfm_data rd ON rt.CustomerID = rd.CustomerID
WHERE rt.Customer_Segment = 'Best Customers'
GROUP BY rd.Location
ORDER BY Number_of_Best_Customers DESC;
13. Which cities are seeing the most churned or at-risk customers?
sql
Copy code
SELECT rd.Location, COUNT(rt.CustomerID) AS Number_of_At_Risk_Customers
FROM RFM_Table rt
JOIN rfm_data rd ON rt.CustomerID = rd.CustomerID
WHERE rt.Customer_Segment = 'At-Risk Customers'
GROUP BY rd.Location
ORDER BY Number_of_At_Risk_Customers DESC;
How to Use
Clone the repository:
bash
Copy code
git clone https://github.com/your-username/Customer-Segmentation-Analysis.git
Load the rfm_data table into your database.
Run the provided SQL script to create the RFM table, calculate RFM scores, and perform customer segmentation analysis.
